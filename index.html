<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Odyssey 3.14 Business Model Coach</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Epic/classic fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700;900&family=Crimson+Pro:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --ink:#111827;
      --muted:#6b7280;
      --paper: rgba(255, 255, 255, 0.86);
      --paper-strong: rgba(255, 255, 255, 0.92);
      --border: rgba(17,24,39,0.12);
      --accent:#2563eb;
      --accent2:#1d4ed8;
      --danger:#b91c1c;
      --ok:#065f46;
    }

    body{
      margin:0;
      min-height:100vh;
      display:flex;
      justify-content:center;
      color:var(--ink);
      font-family: "Crimson Pro", ui-serif, Georgia, serif;
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(255,237,213,0.95), rgba(243,244,246,0.8) 55%, rgba(243,244,246,1)),
        #f3f4f6;
      position:relative;
      overflow-x:hidden;
    }

    body::before{
      content:"";
      position:fixed;
      inset:0;
      background-image: url("https://upload.wikimedia.org/wikipedia/commons/8/89/OdysseySuitors.png");
      background-size: cover;
      background-position: center;
      opacity: 0.10;
      filter: blur(0.6px);
      pointer-events:none;
      z-index:-1;
    }

    .container{
      max-width: 1060px;
      width:100%;
      padding: 28px 18px 44px;
    }

    header{ margin-bottom: 14px; }

    h1{
      font-family: "Cinzel", ui-serif, serif;
      letter-spacing: 0.02em;
      font-weight: 900;
      font-size: clamp(28px, 3.2vw, 44px);
      margin: 0 0 6px 0;
    }

    h2{
      margin:0 0 10px 0;
      color: var(--muted);
      font-weight: 700;
      font-size: 18px;
    }

    .small{
      color: var(--muted);
      font-size: 14px;
      margin: 0;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:14px;
      margin-top: 12px;
    }
    @media (min-width: 960px){
      .grid{ grid-template-columns: 1fr 1fr; }
    }

    .card{
      padding: 16px 18px;
      border-radius: 18px;
      background: var(--paper-strong);
      border: 1px solid var(--border);
      box-shadow: 0 16px 40px rgba(17,24,39,0.10);
    }

    .card h3{
      margin: 0 0 10px 0;
      font-family: "Cinzel", ui-serif, serif;
      letter-spacing: 0.01em;
      font-weight: 800;
      font-size: 18px;
    }

    label{
      display:block;
      margin-top: 12px;
      margin-bottom: 6px;
      font-weight: 800;
    }

    input[type="text"], textarea{
      width:100%;
      box-sizing:border-box;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: var(--paper);
      outline:none;
      transition: box-shadow .15s ease, border-color .15s ease;
      font-family: inherit;
      font-size: 16px;
    }
    textarea{ min-height: 120px; resize: vertical; }

    input:focus, textarea:focus{
      border-color: rgba(37,99,235,0.55);
      box-shadow: 0 0 0 4px rgba(37,99,235,0.14);
    }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top: 10px;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 6px 12px;
      border: 1px solid var(--border);
      border-radius: 999px;
      background: var(--paper);
      font-size: 13px;
      font-weight: 700;
      color:#374151;
    }

    .dot{
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: rgba(37,99,235,0.8);
      box-shadow: 0 0 0 3px rgba(37,99,235,0.15);
    }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 12px;
      align-items:center;
    }

    button{
      padding: 11px 18px;
      border-radius: 999px;
      border: 1px solid rgba(37,99,235,0.25);
      background: linear-gradient(180deg, var(--accent), var(--accent2));
      color:white;
      font-weight: 900;
      cursor:pointer;
      box-shadow: 0 10px 30px rgba(17,24,39,0.12);
      transition: transform .08s ease, box-shadow .2s ease, filter .2s ease;
    }
    button:hover{ transform: translateY(-1px); filter: brightness(1.02); }
    button:active{ transform: translateY(0px); }
    button:disabled{ opacity:0.6; cursor:default; box-shadow:none; }

    .secondary{
      background: rgba(255,255,255,0.55);
      color: var(--ink);
      border: 1px solid var(--border);
      box-shadow: none;
      font-weight: 800;
    }

    .error{
      color: var(--danger);
      margin-top: 10px;
      font-weight: 800;
      white-space: pre-wrap;
    }

    .ok{
      color: var(--ok);
      margin-top: 10px;
      font-weight: 800;
    }

    .checks{
      display:grid;
      grid-template-columns: 1fr;
      gap:8px;
      margin-top: 10px;
    }
    @media (min-width: 960px){
      .checks{ grid-template-columns: 1fr 1fr; }
    }

    .check{
      display:flex;
      gap:10px;
      align-items:flex-start;
      padding:10px 12px;
      border:1px solid var(--border);
      border-radius:14px;
      background: var(--paper);
    }

    .check input{
      margin-top: 3px;
      transform: scale(1.1);
    }

    pre{
      white-space: pre-wrap;
      word-wrap: break-word;
      margin:0;
      font-size: 16px;
      line-height: 1.4;
    }

    .hint{
      color: var(--muted);
      font-size: 13px;
      margin-top: 6px;
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>Odyssey 3.14 Business Model Coach</h1>
      <h2>From “Reference Offer” → “New Business Model” using the 14 Directions + Contributions evaluation.</h2>
      <p class="small">This page auto-detects the best Gemini model your API key can use.</p>
      <div class="row">
        <span class="badge" id="modelBadge"><span class="dot"></span>Model: (detecting…)</span>
      </div>
    </header>

    <div class="grid">
      <section class="card">
        <h3>Reference Offer</h3>

        <label for="vp">1) Value Proposition (What / To whom / At what price)</label>
        <textarea id="vp" placeholder="Describe the current offer, target customers, and pricing..."></textarea>

        <label for="va">2) Value Architecture (Value chain / network / strategic resources)</label>
        <textarea id="va" placeholder="How it is produced and delivered; key partners; capabilities..."></textarea>

        <label for="pe">3) Profit Equation (Revenue / Costs / Capital employed)</label>
        <textarea id="pe" placeholder="Where money comes from, major costs, assets/working capital needed..."></textarea>

        <label for="constraints">Constraints (optional)</label>
        <textarea id="constraints" placeholder="What must NOT change? (budget, regulation, brand, geography, timing...)"></textarea>

        <label for="goals">Objectives (optional)</label>
        <textarea id="goals" placeholder="What do you want to improve? (profit, CO2 reduction, access, employability...)"></textarea>

        <div class="actions">
          <button id="generateBtn" type="button">Generate New Business Model</button>
          <button id="refreshModelsBtn" class="secondary" type="button">Re-check model</button>
        </div>

        <div id="status" class="ok" style="display:none;"></div>
        <div id="error" class="error"></div>
      </section>

      <section class="card">
        <h3>Choose Innovation Directions</h3>
        <div class="hint">Pick 2–5 to focus the ideation (or leave blank and the coach will choose).</div>

        <div class="checks" id="directions">
          <!-- VP directions 1–7 -->
          <label class="check"><input type="checkbox" value="1. Reduce customer overall costs"> <span><strong>1.</strong> Reduce customer overall costs</span></label>
          <label class="check"><input type="checkbox" value="2. Reduce customer hassles"> <span><strong>2.</strong> Reduce customer hassles</span></label>
          <label class="check"><input type="checkbox" value="3. Find non-customers"> <span><strong>3.</strong> Find non-customers</span></label>
          <label class="check"><input type="checkbox" value="4. Add functionality or emotion"> <span><strong>4.</strong> Add functionality or emotion</span></label>
          <label class="check"><input type="checkbox" value="5. Explore other segments or industries"> <span><strong>5.</strong> Explore other segments or industries</span></label>
          <label class="check"><input type="checkbox" value="6. Introduce other stakeholders"> <span><strong>6.</strong> Introduce other stakeholders</span></label>
          <label class="check"><input type="checkbox" value="7. Modify the revenue stream"> <span><strong>7.</strong> Modify the revenue stream</span></label>

          <!-- VA directions 8–14 -->
          <label class="check"><input type="checkbox" value="8. Introduce a technology"> <span><strong>8.</strong> Introduce a technology</span></label>
          <label class="check"><input type="checkbox" value="9. Modify steps in the value chain"> <span><strong>9.</strong> Modify steps in the value chain</span></label>
          <label class="check"><input type="checkbox" value="10. Eliminate or add steps"> <span><strong>10.</strong> Eliminate or add steps</span></label>
          <label class="check"><input type="checkbox" value="11. Identify new inputs"> <span><strong>11.</strong> Identify new inputs</span></label>
          <label class="check"><input type="checkbox" value="12. Associate with competitors/clients/suppliers"> <span><strong>12.</strong> Associate with competitors/clients/suppliers</span></label>
          <label class="check"><input type="checkbox" value="13. Identify complementors"> <span><strong>13.</strong> Identify complementors</span></label>
          <label class="check"><input type="checkbox" value="14. Leverage strategic resources"> <span><strong>14.</strong> Leverage strategic resources</span></label>
        </div>
      </section>
    </div>

    <section id="resultCard" class="card" style="display:none; margin-top:14px;">
      <h3>New Business Model Output</h3>
      <pre id="output"></pre>
      <div class="hint" style="margin-top:10px;">Tip: iterate. Change one input (VP/VA/Profit or directions) and regenerate.</div>
    </section>

    <section id="debug" class="card" style="display:none; margin-top:14px;">
      <h3>Debug</h3>
      <pre id="debugText"></pre>
    </section>
  </div>

  <script>
    /* ===== CONFIG ===== */
    const GEMINI_API_KEY = "AIzaSyDcOqoV01wcmFJPF8GYS1Y4CBCK9z8gOww"; // <-- paste your key here

    /* ===== SYSTEM CONTEXT (your provided framework) ===== */
    const SYSTEM_CONTEXT = `
Role: You are an expert consultant and pedagogical guide in the Odyssey 3.14 business model innovation framework. Your goal is to help students invent new business models.

The Framework: The Odyssey 3.14 approach analyzes a business model through three pillars plus an evaluation of contributions:
1. Value Proposition (VP): Defines the offer.
   - What? The product or service.
   - To whom? The target customer segments.
   - At what price? The pricing model.
2. Value Architecture (VA): How the company generates and delivers the offer.
   - Value Chain: The sequence of activities.
   - Value Network: Key partners and stakeholders.
   - Strategic Resources & Competencies: What the company owns and what it knows how to do.
3. Profit Equation: The economic viability.
   - Revenue: Sources of income.
   - Costs: Cost structure.
   - Capital Employed: Assets and working capital requirements.

The Contributions: Evaluate the model on three dimensions:
1. Financial: Revenue, costs, ROCE.
2. Environmental: Impact on the planet (e.g., carbon footprint, circular economy).
3. Societal: Impact on people (employability, quality of life, fair value sharing).

The Process: Help the user move from a "Reference Offer" to a "New Business Model" by exploring 14 Directions.

The 14 Directions for Innovation:
For Value Proposition:
1. Reduce customer overall costs
2. Reduce customer hassles
3. Find non-customers
4. Add more functionality or emotion
5. Explore other segments or industries
6. Introduce other stakeholders
7. Modify the revenue stream
For Value Architecture:
8. Introduce a technology
9. Modify steps in the value chain
10. Eliminate or add steps
11. Identify new inputs
12. Associate with competitors, clients, or suppliers
13. Identify complementors
14. Leverage strategic resources
    `.trim();

    /* ===== CONSTANTS ===== */
    const BASE = "https://generativelanguage.googleapis.com/v1beta";
    let SELECTED_MODEL = null;

    const modelBadge = document.getElementById("modelBadge");
    const refreshModelsBtn = document.getElementById("refreshModelsBtn");
    const generateBtn = document.getElementById("generateBtn");
    const errorBox = document.getElementById("error");
    const statusBox = document.getElementById("status");
    const resultCard = document.getElementById("resultCard");
    const outputEl = document.getElementById("output");
    const debug = document.getElementById("debug");
    const debugText = document.getElementById("debugText");

    function setModelBadge(html) {
      modelBadge.innerHTML = `<span class="dot"></span>${html}`;
    }
    function showError(msg) {
      errorBox.textContent = msg || "";
    }
    function showStatus(msg) {
      if (!msg) { statusBox.style.display = "none"; statusBox.textContent = ""; return; }
      statusBox.style.display = "block";
      statusBox.textContent = msg;
    }
    function showDebug(obj) {
      debug.style.display = "block";
      debugText.textContent = typeof obj === "string" ? obj : JSON.stringify(obj, null, 2);
    }
    function hideDebug() {
      debug.style.display = "none";
      debugText.textContent = "";
    }

    function pickBestModel(models) {
      const usable = (models || []).filter(m =>
        Array.isArray(m.supportedGenerationMethods) &&
        m.supportedGenerationMethods.includes("generateContent") &&
        typeof m.name === "string"
      );
      if (usable.length === 0) return null;

      const score = (name) => {
        const n = name.toLowerCase();
        if (n.includes("2.5") && n.includes("flash")) return 500;
        if (n.includes("flash")) return 400;
        if (n.includes("pro")) return 300;
        return 200;
      };

      usable.sort((a, b) => score(b.name) - score(a.name));
      return usable[0].name;
    }

    async function detectModel() {
      hideDebug();
      showError("");
      showStatus("");
      setModelBadge("Model: (detecting…)");

      if (!GEMINI_API_KEY || GEMINI_API_KEY === "PUT_YOUR_KEY_HERE") {
        setModelBadge("Model: (missing API key)");
        showError("Paste your Gemini API key into GEMINI_API_KEY first.");
        SELECTED_MODEL = null;
        return;
      }

      const url = `${BASE}/models?key=${encodeURIComponent(GEMINI_API_KEY)}`;
      const res = await fetch(url);
      const text = await res.text();

      if (!res.ok) {
        setModelBadge("Model: (not available)");
        showError(`Model list failed (${res.status}).`);
        showDebug(text);
        SELECTED_MODEL = null;
        return;
      }

      let data;
      try { data = JSON.parse(text); } catch { data = { raw: text }; }

      const best = pickBestModel(data.models || []);
      if (!best) {
        setModelBadge("Model: (none found)");
        showError("No models with generateContent are available for this key.");
        showDebug(data);
        SELECTED_MODEL = null;
        return;
      }

      SELECTED_MODEL = best;
      setModelBadge(`Model: <strong>${SELECTED_MODEL}</strong>`);
      showStatus("Model detected. Ready.");
    }

    function getSelectedDirections() {
      const boxes = document.querySelectorAll('#directions input[type="checkbox"]');
      const selected = [];
      boxes.forEach(b => { if (b.checked) selected.push(b.value); });
      return selected;
    }

    async function generate() {
      hideDebug();
      showError("");
      showStatus("");
      resultCard.style.display = "none";
      outputEl.textContent = "";

      if (!SELECTED_MODEL) {
        showError("No model selected yet. Click “Re-check model” first.");
        return;
      }

      const vp = document.getElementById("vp").value.trim();
      const va = document.getElementById("va").value.trim();
      const pe = document.getElementById("pe").value.trim();

      if (!vp || !va || !pe) {
        showError("Please fill VP, VA, and Profit Equation (they can be short, but not empty).");
        return;
      }

      const constraints = document.getElementById("constraints").value.trim();
      const goals = document.getElementById("goals").value.trim();
      const directions = getSelectedDirections();

      const userInput = `
Reference Offer:
- Value Proposition (VP):
${vp}

- Value Architecture (VA):
${va}

- Profit Equation:
${pe}

Constraints (optional):
${constraints || "(none provided)"}

Objectives (optional):
${goals || "(none provided)"}

Selected Innovation Directions:
${directions.length ? directions.map(d => "- " + d).join("\n") : "(none selected — you choose the best 3–5 directions)"}
      `.trim();

      const instruction = `
${SYSTEM_CONTEXT}

Task:
Help the student transform the Reference Offer into a New Business Model.

Output format (use EXACT headings):
A) Diagnosis of the Reference Offer (max 8 bullets)
- 2–3 strengths and 4–6 weaknesses/gaps across VP/VA/Profit.

B) New Business Model (one recommended concept)
- VP: What / To whom / At what price
- VA: value chain (key steps), value network (partners), strategic resources/competencies
- Profit Equation: revenue streams, key costs, capital employed (what assets/working capital), and a quick viability note

C) 14 Directions used
- List the specific directions you used (at least 3). If the student selected directions, prioritize them.

D) Contributions evaluation (Financial / Environmental / Societal)
- Provide a small scorecard:
  Financial: score 1–5 + 3 justification bullets
  Environmental: score 1–5 + 3 justification bullets
  Societal: score 1–5 + 3 justification bullets
- Mention one key trade-off.

E) Next experiments (5 items)
- 5 concrete, low-cost tests the student should run next week.

Constraints:
- Be concrete, avoid generic advice.
- Do NOT invent real data; if assumptions are needed, label them “Assumption: …”.
- Keep total length under ~650 words.
      `.trim();

      const prompt = instruction + "\n\n=== STUDENT INPUT ===\n" + userInput;

      generateBtn.disabled = true;
      generateBtn.textContent = "Generating…";

      const url = `${BASE}/${SELECTED_MODEL}:generateContent?key=${encodeURIComponent(GEMINI_API_KEY)}`;
      let attempts = 0;
      const maxAttempts = 3;

      while (attempts < maxAttempts) {
        try {
          const res = await fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              contents: [{ parts: [{ text: prompt }] }]
            })
          });

          const raw = await res.text();

          if (res.ok) {
            let data;
            try { data = JSON.parse(raw); } catch { data = { raw }; }

            const out =
              data.candidates?.[0]?.content?.parts?.map(p => p.text || "").join("\n") ||
              "No response text returned.";

            outputEl.textContent = out;
            resultCard.style.display = "block";
            showStatus("Done. Iterate by changing one thing and regenerating.");
            break;
          }

          if (res.status === 503) {
            attempts++;
            if (attempts >= maxAttempts) {
              showError("The AI is busy right now (overloaded). Wait ~30–60 seconds and try again.");
              showDebug(raw);
              break;
            }
            showStatus("Model is busy — retrying…");
            await new Promise(r => setTimeout(r, 1200 * attempts));
            continue;
          }

          showError(`Gemini error ${res.status}`);
          showDebug(raw);
          break;

        } catch (e) {
          showError(String(e));
          break;
        }
      }

      generateBtn.disabled = false;
      generateBtn.textContent = "Generate New Business Model";
    }

    refreshModelsBtn.addEventListener("click", detectModel);
    generateBtn.addEventListener("click", generate);

    // Auto-detect on load
    detectModel();
  </script>
</body>
</html>
