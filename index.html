<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Odyssey 3.14 AI Tutor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f3f4f6;
      color: #111827;
      display: flex;
      justify-content: center;
    }
    .container {
      max-width: 900px;
      width: 100%;
      padding: 24px;
    }
    h1 {
      font-size: 1.8rem;
      margin-bottom: 0.25rem;
    }
    h2 {
      font-size: 1.1rem;
      margin-top: 0;
      color: #6b7280;
      font-weight: 500;
    }
    label {
      display: block;
      margin-top: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    select, textarea, button {
      font: inherit;
    }
    select, textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      background: white;
      outline: none;
    }
    select:focus, textarea:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px #2563eb20;
    }
    textarea {
      resize: vertical;
      min-height: 150px;
    }
    button {
      margin-top: 16px;
      padding: 10px 18px;
      border-radius: 999px;
      border: none;
      background: #2563eb;
      color: white;
      font-weight: 600;
      cursor: pointer;
    }
    button:disabled {
      opacity: 0.6;
      cursor: default;
    }
    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }
    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      font-size: 0.75rem;
      background: #f9fafb;
      color: #4b5563;
    }
    .card {
      margin-top: 24px;
      padding: 16px 18px;
      border-radius: 12px;
      background: white;
      border: 1px solid #e5e7eb;
    }
    .card h3 {
      margin-top: 0;
      margin-bottom: 8px;
    }
    .small {
      font-size: 0.8rem;
      color: #6b7280;
    }
    .error {
      color: #b91c1c;
      margin-top: 8px;
      font-size: 0.9rem;
    }
    .spinner {
      display: inline-block;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      border: 2px solid #bfdbfe;
      border-top-color: #2563eb;
      animation: spin 0.7s linear infinite;
      margin-right: 6px;
      vertical-align: -2px;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    pre {
      white-space: pre-wrap;
      word-wrap: break-word;
      margin: 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Odyssey 3.14 AI Tutor</h1>
      <h2>Get guided feedback on each step of your business model.</h2>
      <p class="small">
        1. Pick the Odyssey 3.14 step · 2. Paste your draft · 3. Click “Get feedback”.
      </p>
    </header>

    <main>
      <label for="step">Which Odyssey 3.14 step are you working on?</label>
      <select id="step">
        <option value="Vision">Vision</option>
        <option value="Business Arena">Business arena</option>
        <option value="Value Proposition">Value proposition</option>
        <option value="Resources & Capabilities">Resources & capabilities</option>
        <option value="Key Activities">Key activities</option>
        <option value="Revenue Model">Revenue model</option>
        <option value="Cost Structure">Cost structure</option>
        <option value="Differentiation / Competitive Advantage">Differentiation / competitive advantage</option>
        <option value="Innovation Levers">Innovation levers (3.14)</option>
      </select>

      <label for="draft">Your draft for this step</label>
      <textarea id="draft" placeholder="Describe your idea for this step. Be as concrete as possible."></textarea>

      <div class="pill-row">
        <div class="pill">Tip: mention your target customers</div>
        <div class="pill">Tip: be specific, avoid buzzwords</div>
        <div class="pill">Tip: 5–10 lines is enough</div>
      </div>

      <button id="submitBtn">Get feedback</button>
      <div id="error" class="error"></div>

      <section class="card" id="responseCard" style="display:none;">
        <h3>AI feedback</h3>
        <pre id="responseText"></pre>
        <p class="small" style="margin-top:12px;">
          This feedback is generated by an AI tutor based on the Odyssey 3.14 framework.
          Always combine it with your own judgment and your teacher’s comments.
        </p>
      </section>

      <section class="card" style="margin-top:24px;">
        <h3>How it works (for teachers)</h3>
        <p class="small">
          The page sends the selected step and the student’s text to a Gemini model with a
          fixed “tutor” instruction that follows Odyssey 3.14. The model returns:
          (1) a short evaluation, (2) 2–3 suggestions to improve the idea,
          and (3) a checklist of missing elements. No data is stored on a server.
        </p>
        <p class="small">
          Technical: static HTML on GitHub Pages, vanilla JS, Gemini 2.0 Flash (free-tier) API call via fetch.
        </p>
      </section>
    </main>
  </div>

  <script>
    // -------------------------------
    // 1. CONFIG: PUT YOUR GEMINI KEY HERE
    // -------------------------------
    const GEMINI_API_KEY = "AIzaSyDcOqoV01wcmFJPF8GYS1Y4CBCK9z8gOww"; // <<< CHANGE THIS
    const GEMINI_MODEL = "models/gemini-2.0-flash";    // free-tier, strong & fast  [oai_citation:3‡Google AI for Developers](https://ai.google.dev/gemini-api/docs/models?utm_source=chatgpt.com)

    const submitBtn = document.getElementById("submitBtn");
    const stepSelect = document.getElementById("step");
    const draftInput = document.getElementById("draft");
    const responseCard = document.getElementById("responseCard");
    const responseText = document.getElementById("responseText");
    const errorBox = document.getElementById("error");

    async function getFeedback() {
      errorBox.textContent = "";
      const step = stepSelect.value;
      const draft = draftInput.value.trim();

      if (!draft) {
        errorBox.textContent = "Please write something for this step before asking for feedback.";
        return;
      }

      // Disable button + show loading state
      submitBtn.disabled = true;
      const originalLabel = submitBtn.textContent;
      submitBtn.innerHTML = '<span class="spinner"></span>Getting feedback...';

      // Instruction for Gemini
      const systemPrompt = `
You are an AI tutor helping students apply the Odyssey 3.14 business model innovation method.
The student is working on ONE specific step of their business model.

General guidelines:
- Be concrete and practical, not vague.
- Use simple, clear language (B2 English).
- Be supportive but honest.
- Adapt your feedback to the given step.

For every answer, respond using this structure:

1. Quick evaluation (3–4 sentences)
- Comment on clarity, coherence, and realism for THIS step.

2. Suggestions to improve (numbered list, 3–5 items)
- Each suggestion should be specific and actionable.
- Try to push the student to explore new options or assumptions.

3. Checklist (bullet list)
- 4–6 bullets starting with "[ ]" or "[x]" depending on whether the point seems covered.
- Focus on typical criteria for this Odyssey 3.14 step.

Keep the whole answer under ~300 words.
      `.trim();

      const userPrompt = `
Odyssey 3.14 step: ${step}

Student's draft:
---
${draft}
---

Please give feedback following the 3-part structure:
1. Quick evaluation
2. Suggestions to improve
3. Checklist
      `.trim();

      try {
        const response = await fetch(
          "https://generativelanguage.googleapis.com/v1beta/" + GEMINI_MODEL + ":generateContent?key=" + GEMINI_API_KEY,
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              contents: [
                {
                  role: "user",
                  parts: [
                    { text: systemPrompt + "\n\n" + userPrompt }
                  ]
                }
              ]
            })
          }
        );

        if (!response.ok) {
          const text = await response.text();
          console.error("Gemini API error:", text);
          throw new Error("Gemini API error: " + response.status);
        }

        const data = await response.json();
        const candidates = data.candidates || [];
        let textResponse = "No response from model.";
        if (
          candidates.length > 0 &&
          candidates[0].content &&
          candidates[0].content.parts &&
          candidates[0].content.parts.length > 0
        ) {
          textResponse = candidates[0].content.parts.map(p => p.text || "").join("\n");
        }

        responseText.textContent = textResponse;
        responseCard.style.display = "block";
      } catch (err) {
        console.error(err);
        errorBox.textContent = "Something went wrong while contacting the AI. Check your API key, free tier status, and network connection.";
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = originalLabel;
      }
    }

    submitBtn.addEventListener("click", getFeedback);
  </script>
</body>
</html>
